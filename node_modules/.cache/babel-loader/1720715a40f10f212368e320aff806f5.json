{"ast":null,"code":"var _jsxFileName = \"/home/chris/repos/StarkClass_Server/client/src/components/mercadoPago/index.cem.js\";\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nconst baseMercadoPagoUrl = \"https://secure.mlstatic.com/sdk/javascript/v1/mercadopago.js\";\nconst mercadoPagoId = \"mercado-pagojs\";\nconst mercadoPagoUrl = `${baseMercadoPagoUrl}`;\n\nclass MercadoPago extends Component {\n  constructor(props) {\n    super(props);\n    this.doSubmit = false;\n\n    this.initMercadoPago = () => {\n      window.Mercadopago.setPublishableKey(\"APP_USR-7aa96788-ec38-46fb-9f9b-0a01a2104d501\");\n    };\n\n    this.mercadoLoad = e => {\n      if (window.Mercadopago) {\n        this.initMercadoPago();\n        console.log(\"mercadoPago\", window.Mercadopago);\n      }\n    };\n\n    this.mercadoEvent = mercadoEvent => {\n      const {\n        origin,\n        data\n      } = mercadoEvent;\n      this.initMercadoPago();\n\n      if (typeof data === \"string\") {\n        console.log(\"data es igual a string\");\n        console.log(\"mercadoPago\", window.Mercadopago);\n      }\n    };\n\n    this.doPay = event => {\n      let cardNumber = this.state.cardNumber;\n      event.preventDefault();\n      console.log(\"dopay is called\");\n      console.log(\"mercadoPago\", window.Mercadopago);\n      var $form = document.querySelector(\"#pay\");\n      let token = window.Mercadopago.createToken($form, this.sdkResponseHandler); // The function \"sdkResponseHandler\" is defined below\n\n      console.log(\"token: \", token);\n      return false;\n    };\n\n    this.setPaymentMethodInfo = (status, response) => {\n      console.log(\"status\", status);\n      console.log(\"response\", response);\n      let bin = this.state.cardNumber.substring(0, 6);\n\n      if (status == 200) {\n        const paymentMethodElement = document.querySelector(\"input[name=paymentMethodId]\");\n\n        if (paymentMethodElement) {\n          paymentMethodElement.value = response[0].id;\n        } else {\n          let form = document.querySelector(\"#pay\");\n          const input = document.createElement(\"input\");\n          input.setAttribute(\"name\", \"paymentMethodId\");\n          input.setAttribute(\"type\", \"hidden\");\n          input.setAttribute(\"value\", response[0].id);\n          form.appendChild(input);\n        }\n\n        window.Mercadopago.getInstallments({\n          bin: bin,\n          amount: parseFloat(document.querySelector(\"#amount\").value)\n        }, this.setInstallmentInfo);\n      } else {\n        alert(`payment method info error: ${response}`);\n      }\n    };\n\n    this.sdkResponseHandler = (status, response) => {\n      console.log(\"status \", status);\n      console.log(\"response \", response);\n\n      if (status != 200 && status != 201) {\n        alert(\"Error al validar la información\");\n      } else {\n        var form = document.querySelector(\"#pay\");\n        var card = document.createElement(\"input\");\n        card.setAttribute(\"name\", \"token\");\n        card.setAttribute(\"type\", \"hidden\");\n        card.setAttribute(\"value\", response.id);\n        form.appendChild(card);\n        this.doSubmit = true;\n        form.submit();\n      }\n    };\n\n    this.state = {\n      amount: 0,\n      cardNumber: \"\",\n      docNumber: \"\",\n      email: \"\"\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.cupon === \"STARKCLASS50\") {\n      //check this logic !!!\n      alert(\"cupón aceptado\");\n      window.location.replace(\"https://express.culqi.com/pago/6339-2032\"); //window.location.reload();\n    } else {\n      alert(\"no valido \");\n      window.location.reload();\n    }\n\n    const script = document.createElement(\"script\");\n    console.log(\"auth: \", this.props.auth);\n    script.id = mercadoPagoId;\n    script.src = mercadoPagoUrl;\n    script.async = true;\n    script.onload = this.mercadoLoad;\n    this.mercadoPagoScript = script;\n    document.body.appendChild(this.mercadoPagoScript);\n    const input = window.onload = document.getElementById(\"cardNumber\");\n\n    input.onpaste = function (e) {\n      e.preventDefault();\n    };\n\n    window.addEventListener(\"message\", this.mercadoEvent, false);\n    this.addEvent(document.querySelector(\"#pay\"), \"submit\", this.doPay);\n  }\n\n  addEvent(to, type, fn) {\n    if (document.addEventListener) {\n      to.addEventListener(type, fn, false);\n    } else if (document.attachEvent) {\n      to.attachEvent(\"on\" + type, fn);\n    } else {\n      to[\"on\" + type] = fn;\n    }\n  }\n\n  setInstallmentInfo(status, response) {\n    var selectorInstallments = document.querySelector(\"#installments\"),\n        fragment = document.createDocumentFragment();\n    selectorInstallments.options.length = 0;\n\n    if (response.length > 0) {\n      var option = new Option(\"Eliga\", \"-1\"),\n          payerCosts = response[0].payer_costs;\n      fragment.appendChild(option);\n\n      for (var i = 0; i < payerCosts.length; i++) {\n        fragment.appendChild(new Option(payerCosts[i].recommended_message, payerCosts[i].installments));\n      }\n\n      selectorInstallments.appendChild(fragment);\n      selectorInstallments.removeAttribute(\"disabled\");\n    }\n  }\n\n  guessingPaymentMethod() {\n    console.log(this.state);\n    var bin = this.state.cardNumber;\n\n    if (bin.length == 6) {\n      window.Mercadopago.getPaymentMethod({\n        bin: bin\n      }, this.setPaymentMethodInfo);\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 7\n      }\n    }) // <ReactShadowScroll>\n    // <form\n    //   id=\"pay\"\n    //   name=\"pay\"\n    //   method=\"POST\"\n    //   action={`${process.env.REACT_APP_API_URL}/api/pagos/pay`}\n    //   style={{ height: 400, overflow: \"auto\", overflowX: \"hidden\" }}\n    // >\n    //   <div className=\"row\">\n    //     <div className=\"form-group col-lg-6 col-md-6 col-sm-6\">\n    //       <label htmlFor=\"cardholderName\">Titular de la tarjeta</label>\n    //       <input\n    //         className=\"form-control\"\n    //         type=\"text\"\n    //         id=\"cardholderName\"\n    //         data-checkout=\"cardholderName\"\n    //       />\n    //     </div>\n    //     <div className=\"form-group col-lg-6 col-md-6 col-sm-6\">\n    //       <label htmlFor=\"email\">Email</label>\n    //       <input\n    //         className=\"form-control \"\n    //         type=\"email\"\n    //         id=\"email\"\n    //         name=\"email\"\n    //         value={this.state.email}\n    //         onChange={e => {\n    //           this.setState({ email: e.target.value });\n    //         }}\n    //       />\n    //     </div>\n    //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n    //       <label htmlFor=\"cardNumber\">Número de tarjeta</label>\n    //       <input\n    //         className=\"form-control\"\n    //         type=\"text\"\n    //         id=\"cardNumber\"\n    //         data-checkout=\"cardNumber\"\n    //         value={this.state.cardNumber}\n    //         onChange={e => {\n    //           this.guessingPaymentMethod();\n    //           this.setState({ cardNumber: e.target.value });\n    //         }}\n    //         onPaste={() => false}\n    //         onCopy={() => false}\n    //         onCut={() => false}\n    //         onDrag={() => false}\n    //         onDrop={() => false}\n    //         autoComplete=\"off\"\n    //       />\n    //     </div>\n    //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n    //       <label htmlFor=\"cardExpirationMonth\">Mes de expiración</label>\n    //       <input\n    //         className=\"form-control\"\n    //         type=\"text\"\n    //         id=\"cardExpirationMonth\"\n    //         data-checkout=\"cardExpirationMonth\"\n    //         onPaste={() => false}\n    //         onCopy={() => false}\n    //         onCut={() => false}\n    //         onDrag={() => false}\n    //         onDrop={() => false}\n    //         autoComplete=\"off\"\n    //       />\n    //     </div>\n    //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n    //       <label htmlFor=\"cardExpirationYear\">Año de expiración</label>\n    //       <input\n    //         className=\"form-control\"\n    //         type=\"text\"\n    //         id=\"cardExpirationYear\"\n    //         data-checkout=\"cardExpirationYear\"\n    //         onPaste={() => false}\n    //         onCopy={() => false}\n    //         onCut={() => false}\n    //         onDrag={() => false}\n    //         onDrop={() => false}\n    //         autoComplete=\"off\"\n    //       />\n    //     </div>\n    //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n    //       <label htmlFor=\"securityCode\">CVV</label>\n    //       <input\n    //         className=\"form-control\"\n    //         type=\"text\"\n    //         id=\"securityCode\"\n    //         data-checkout=\"securityCode\"\n    //         onPaste={() => false}\n    //         onCopy={() => false}\n    //         onCut={() => false}\n    //         onDrag={() => false}\n    //         onDrop={() => false}\n    //         autoComplete=\"off\"\n    //       />\n    //     </div>\n    //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n    //       <label for=\"docType\">Tipo de documento</label>\n    //       <select\n    //         id=\"docType\"\n    //         data-checkout=\"docType\"\n    //         className=\"form-control\"\n    //       >\n    //         <option value=\"DNI\">DNI</option>\n    //         <option value=\"CEX\">Carnet de Extranjería</option>\n    //       </select>\n    //     </div>\n    //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n    //       <label for=\"docNumber\">Número de documento</label>\n    //       <input\n    //         className=\"form-control\"\n    //         type=\"text\"\n    //         id=\"docNumber\"\n    //         data-checkout=\"docNumber\"\n    //         value={this.state.docNumber}\n    //         onChange={e => {\n    //           this.setState({ docNumber: e.target.value });\n    //         }}\n    //       />\n    //     </div>\n    //     <div className=\"form-group col-lg-12 col-md-12 col-sm-12\">\n    //       <div className=\"form-group\">\n    //         <label htmlFor=\"installments\">Cuotas:</label>\n    //         <select\n    //           id=\"installments\"\n    //           className=\"form-control\"\n    //           name=\"installments\"\n    //         >\n    //           <option value=\"0\">0 cuotas</option>\n    //           <option value=\"1\">1 cuota</option>\n    //         </select>\n    //       </div>\n    //     </div>\n    //     <div className=\"form-group col-lg-12 col-md-12 col-sm-12\">\n    //       <input\n    //         type=\"hidden\"\n    //         name=\"amount\"\n    //         id=\"amount\"\n    //         value={this.props.cupon === \"STARKCLASS50\" ? 299 : 349}\n    //       />\n    //       <input\n    //         type=\"hidden\"\n    //         name=\"description\"\n    //         value=\"Starkclass ciclo PRE uLima\"\n    //       />\n    //       <input\n    //         type=\"hidden\"\n    //         name=\"userId\"\n    //         value={this.props.auth.user.id}\n    //       />\n    //       <input\n    //         type=\"hidden\"\n    //         name=\"userEmail\"\n    //         value={this.props.auth.user.email || \"\"}\n    //       />\n    //       <input\n    //         type=\"submit\"\n    //         value={\n    //           this.props.cupon === \"STARKCLASS51\"\n    //             ? \"Pagar S/ 2.00\"\n    //             : \"Pagar S/ 349.00\"\n    //         }\n    //         className=\"btn btn-lg btn-primary w-100\"\n    //       />\n    //     </div>\n    //   </div>\n    // </form>\n    // // </ReactShadowScroll>\n    ;\n  }\n\n}\n\nconst mapStateToProps = state => ({\n  auth: state.auth\n});\n\nconst mapDispatchToProps = (dispatch, props) => ({});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MercadoPago);","map":{"version":3,"sources":["/home/chris/repos/StarkClass_Server/client/src/components/mercadoPago/index.cem.js"],"names":["React","Component","connect","baseMercadoPagoUrl","mercadoPagoId","mercadoPagoUrl","MercadoPago","constructor","props","doSubmit","initMercadoPago","window","Mercadopago","setPublishableKey","mercadoLoad","e","console","log","mercadoEvent","origin","data","doPay","event","cardNumber","state","preventDefault","$form","document","querySelector","token","createToken","sdkResponseHandler","setPaymentMethodInfo","status","response","bin","substring","paymentMethodElement","value","id","form","input","createElement","setAttribute","appendChild","getInstallments","amount","parseFloat","setInstallmentInfo","alert","card","submit","docNumber","email","componentDidMount","cupon","location","replace","reload","script","auth","src","async","onload","mercadoPagoScript","body","getElementById","onpaste","addEventListener","addEvent","to","type","fn","attachEvent","selectorInstallments","fragment","createDocumentFragment","options","length","option","Option","payerCosts","payer_costs","i","recommended_message","installments","removeAttribute","guessingPaymentMethod","getPaymentMethod","render","mapStateToProps","mapDispatchToProps","dispatch"],"mappings":"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,CAAb;AAAA,UACEC,UAAU,GAAG/C,QAAQ,CAAC,CAAD,CAAR,CAAYgD,WAD3B;AAEAP,MAAAA,QAAQ,CAAC/B,WAAT,CAAqBmC,MAArB;;AAEA,WAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,UAAU,CAACH,MAA/B,EAAuCK,CAAC,EAAxC,EAA4C;AAC1CR,QAAAA,QAAQ,CAAC/B,WAAT,CACE,IAAIoC,MAAJ,CACEC,UAAU,CAACE,CAAD,CAAV,CAAcC,mBADhB,EAEEH,UAAU,CAACE,CAAD,CAAV,CAAcE,YAFhB,CADF;AAMD;;AAEDX,MAAAA,oBAAoB,CAAC9B,WAArB,CAAiC+B,QAAjC;AACAD,MAAAA,oBAAoB,CAACY,eAArB,CAAqC,UAArC;AACD;AACF;;AAEDC,EAAAA,qBAAqB,GAAG;AACtBvE,IAAAA,OAAO,CAACC,GAAR,CAAY,KAAKO,KAAjB;AACA,QAAIW,GAAG,GAAG,KAAKX,KAAL,CAAWD,UAArB;;AAEA,QAAIY,GAAG,CAAC2C,MAAJ,IAAc,CAAlB,EAAqB;AACnBnE,MAAAA,MAAM,CAACC,WAAP,CAAmB4E,gBAAnB,CACE;AACErD,QAAAA,GAAG,EAAEA;AADP,OADF,EAIE,KAAKH,oBAJP;AAMD;AACF;;AAmBDyD,EAAAA,MAAM,GAAG;AACP,wBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CAEE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1KF;AA4KD;;AA5ViC;;AA+VpC,MAAMC,eAAe,GAAGlE,KAAK,KAAK;AAChCoC,EAAAA,IAAI,EAAEpC,KAAK,CAACoC;AADoB,CAAL,CAA7B;;AAIA,MAAM+B,kBAAkB,GAAG,CAACC,QAAD,EAAWpF,KAAX,MAAsB,EAAtB,CAA3B;;AAEA,eAAeN,OAAO,CAACwF,eAAD,EAAkBC,kBAAlB,CAAP,CAA6CrF,WAA7C,CAAf","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\n\nconst baseMercadoPagoUrl =\n  \"https://secure.mlstatic.com/sdk/javascript/v1/mercadopago.js\";\nconst mercadoPagoId = \"mercado-pagojs\";\nconst mercadoPagoUrl = `${baseMercadoPagoUrl}`;\n\nclass MercadoPago extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      amount: 0,\n      cardNumber: \"\",\n      docNumber: \"\",\n      email: \"\"\n    };\n  }\n  doSubmit = false;\n\n  componentDidMount() {\n    if (this.props.cupon === \"STARKCLASS50\") {\n      //check this logic !!!\n      alert(\"cupón aceptado\");\n      window.location.replace(\"https://express.culqi.com/pago/6339-2032\");\n      //window.location.reload();\n    } else {\n      alert(\"no valido \");\n      window.location.reload();\n    }\n    const script = document.createElement(\"script\");\n    console.log(\"auth: \", this.props.auth);\n    script.id = mercadoPagoId;\n    script.src = mercadoPagoUrl;\n    script.async = true;\n    script.onload = this.mercadoLoad;\n\n    this.mercadoPagoScript = script;\n\n    document.body.appendChild(this.mercadoPagoScript);\n    const input = (window.onload = document.getElementById(\"cardNumber\"));\n    input.onpaste = function(e) {\n      e.preventDefault();\n    };\n    window.addEventListener(\"message\", this.mercadoEvent, false);\n    this.addEvent(document.querySelector(\"#pay\"), \"submit\", this.doPay);\n  }\n\n  initMercadoPago = () => {\n    window.Mercadopago.setPublishableKey(\n      \"APP_USR-7aa96788-ec38-46fb-9f9b-0a01a2104d501\"\n    );\n  };\n\n  mercadoLoad = e => {\n    if (window.Mercadopago) {\n      this.initMercadoPago();\n      console.log(\"mercadoPago\", window.Mercadopago);\n    }\n  };\n\n  mercadoEvent = mercadoEvent => {\n    const { origin, data } = mercadoEvent;\n    this.initMercadoPago();\n\n    if (typeof data === \"string\") {\n      console.log(\"data es igual a string\");\n      console.log(\"mercadoPago\", window.Mercadopago);\n    }\n  };\n\n  doPay = event => {\n    let cardNumber = this.state.cardNumber;\n    event.preventDefault();\n    console.log(\"dopay is called\");\n    console.log(\"mercadoPago\", window.Mercadopago);\n\n    var $form = document.querySelector(\"#pay\");\n\n    let token = window.Mercadopago.createToken($form, this.sdkResponseHandler); // The function \"sdkResponseHandler\" is defined below\n\n    console.log(\"token: \", token);\n    return false;\n  };\n\n  addEvent(to, type, fn) {\n    if (document.addEventListener) {\n      to.addEventListener(type, fn, false);\n    } else if (document.attachEvent) {\n      to.attachEvent(\"on\" + type, fn);\n    } else {\n      to[\"on\" + type] = fn;\n    }\n  }\n\n  setPaymentMethodInfo = (status, response) => {\n    console.log(\"status\", status);\n    console.log(\"response\", response);\n    let bin = this.state.cardNumber.substring(0, 6);\n    if (status == 200) {\n      const paymentMethodElement = document.querySelector(\n        \"input[name=paymentMethodId]\"\n      );\n\n      if (paymentMethodElement) {\n        paymentMethodElement.value = response[0].id;\n      } else {\n        let form = document.querySelector(\"#pay\");\n        const input = document.createElement(\"input\");\n        input.setAttribute(\"name\", \"paymentMethodId\");\n        input.setAttribute(\"type\", \"hidden\");\n        input.setAttribute(\"value\", response[0].id);\n\n        form.appendChild(input);\n      }\n\n      window.Mercadopago.getInstallments(\n        {\n          bin: bin,\n          amount: parseFloat(document.querySelector(\"#amount\").value)\n        },\n        this.setInstallmentInfo\n      );\n    } else {\n      alert(`payment method info error: ${response}`);\n    }\n  };\n\n  setInstallmentInfo(status, response) {\n    var selectorInstallments = document.querySelector(\"#installments\"),\n      fragment = document.createDocumentFragment();\n    selectorInstallments.options.length = 0;\n\n    if (response.length > 0) {\n      var option = new Option(\"Eliga\", \"-1\"),\n        payerCosts = response[0].payer_costs;\n      fragment.appendChild(option);\n\n      for (var i = 0; i < payerCosts.length; i++) {\n        fragment.appendChild(\n          new Option(\n            payerCosts[i].recommended_message,\n            payerCosts[i].installments\n          )\n        );\n      }\n\n      selectorInstallments.appendChild(fragment);\n      selectorInstallments.removeAttribute(\"disabled\");\n    }\n  }\n\n  guessingPaymentMethod() {\n    console.log(this.state);\n    var bin = this.state.cardNumber;\n\n    if (bin.length == 6) {\n      window.Mercadopago.getPaymentMethod(\n        {\n          bin: bin\n        },\n        this.setPaymentMethodInfo\n      );\n    }\n  }\n\n  sdkResponseHandler = (status, response) => {\n    console.log(\"status \", status);\n    console.log(\"response \", response);\n    if (status != 200 && status != 201) {\n      alert(\"Error al validar la información\");\n    } else {\n      var form = document.querySelector(\"#pay\");\n      var card = document.createElement(\"input\");\n      card.setAttribute(\"name\", \"token\");\n      card.setAttribute(\"type\", \"hidden\");\n      card.setAttribute(\"value\", response.id);\n      form.appendChild(card);\n      this.doSubmit = true;\n      form.submit();\n    }\n  };\n\n  render() {\n    return (\n      <div></div>\n      // <ReactShadowScroll>\n      // <form\n      //   id=\"pay\"\n      //   name=\"pay\"\n      //   method=\"POST\"\n      //   action={`${process.env.REACT_APP_API_URL}/api/pagos/pay`}\n      //   style={{ height: 400, overflow: \"auto\", overflowX: \"hidden\" }}\n      // >\n      //   <div className=\"row\">\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-6\">\n      //       <label htmlFor=\"cardholderName\">Titular de la tarjeta</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"cardholderName\"\n      //         data-checkout=\"cardholderName\"\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-6\">\n      //       <label htmlFor=\"email\">Email</label>\n      //       <input\n      //         className=\"form-control \"\n      //         type=\"email\"\n      //         id=\"email\"\n      //         name=\"email\"\n      //         value={this.state.email}\n      //         onChange={e => {\n      //           this.setState({ email: e.target.value });\n      //         }}\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label htmlFor=\"cardNumber\">Número de tarjeta</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"cardNumber\"\n      //         data-checkout=\"cardNumber\"\n      //         value={this.state.cardNumber}\n      //         onChange={e => {\n      //           this.guessingPaymentMethod();\n      //           this.setState({ cardNumber: e.target.value });\n      //         }}\n      //         onPaste={() => false}\n      //         onCopy={() => false}\n      //         onCut={() => false}\n      //         onDrag={() => false}\n      //         onDrop={() => false}\n      //         autoComplete=\"off\"\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label htmlFor=\"cardExpirationMonth\">Mes de expiración</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"cardExpirationMonth\"\n      //         data-checkout=\"cardExpirationMonth\"\n      //         onPaste={() => false}\n      //         onCopy={() => false}\n      //         onCut={() => false}\n      //         onDrag={() => false}\n      //         onDrop={() => false}\n      //         autoComplete=\"off\"\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label htmlFor=\"cardExpirationYear\">Año de expiración</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"cardExpirationYear\"\n      //         data-checkout=\"cardExpirationYear\"\n      //         onPaste={() => false}\n      //         onCopy={() => false}\n      //         onCut={() => false}\n      //         onDrag={() => false}\n      //         onDrop={() => false}\n      //         autoComplete=\"off\"\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label htmlFor=\"securityCode\">CVV</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"securityCode\"\n      //         data-checkout=\"securityCode\"\n      //         onPaste={() => false}\n      //         onCopy={() => false}\n      //         onCut={() => false}\n      //         onDrag={() => false}\n      //         onDrop={() => false}\n      //         autoComplete=\"off\"\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label for=\"docType\">Tipo de documento</label>\n      //       <select\n      //         id=\"docType\"\n      //         data-checkout=\"docType\"\n      //         className=\"form-control\"\n      //       >\n      //         <option value=\"DNI\">DNI</option>\n      //         <option value=\"CEX\">Carnet de Extranjería</option>\n      //       </select>\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label for=\"docNumber\">Número de documento</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"docNumber\"\n      //         data-checkout=\"docNumber\"\n      //         value={this.state.docNumber}\n      //         onChange={e => {\n      //           this.setState({ docNumber: e.target.value });\n      //         }}\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-12 col-md-12 col-sm-12\">\n      //       <div className=\"form-group\">\n      //         <label htmlFor=\"installments\">Cuotas:</label>\n      //         <select\n      //           id=\"installments\"\n      //           className=\"form-control\"\n      //           name=\"installments\"\n      //         >\n      //           <option value=\"0\">0 cuotas</option>\n      //           <option value=\"1\">1 cuota</option>\n      //         </select>\n      //       </div>\n      //     </div>\n      //     <div className=\"form-group col-lg-12 col-md-12 col-sm-12\">\n      //       <input\n      //         type=\"hidden\"\n      //         name=\"amount\"\n      //         id=\"amount\"\n      //         value={this.props.cupon === \"STARKCLASS50\" ? 299 : 349}\n      //       />\n      //       <input\n      //         type=\"hidden\"\n      //         name=\"description\"\n      //         value=\"Starkclass ciclo PRE uLima\"\n      //       />\n      //       <input\n      //         type=\"hidden\"\n      //         name=\"userId\"\n      //         value={this.props.auth.user.id}\n      //       />\n      //       <input\n      //         type=\"hidden\"\n      //         name=\"userEmail\"\n      //         value={this.props.auth.user.email || \"\"}\n      //       />\n\n      //       <input\n      //         type=\"submit\"\n      //         value={\n      //           this.props.cupon === \"STARKCLASS51\"\n      //             ? \"Pagar S/ 2.00\"\n      //             : \"Pagar S/ 349.00\"\n      //         }\n      //         className=\"btn btn-lg btn-primary w-100\"\n      //       />\n      //     </div>\n      //   </div>\n      // </form>\n      // // </ReactShadowScroll>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  auth: state.auth\n});\n\nconst mapDispatchToProps = (dispatch, props) => ({});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MercadoPago);\n"]},"metadata":{},"sourceType":"module"}