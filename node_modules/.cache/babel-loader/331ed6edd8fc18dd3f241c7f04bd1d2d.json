{"ast":null,"code":"import _classCallCheck from\"/home/chris/repos/StarkClass_Server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/chris/repos/StarkClass_Server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _createSuper from\"/home/chris/repos/StarkClass_Server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _inherits from\"/home/chris/repos/StarkClass_Server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import{connect}from\"react-redux\";var baseMercadoPagoUrl=\"https://secure.mlstatic.com/sdk/javascript/v1/mercadopago.js\";var mercadoPagoId=\"mercado-pagojs\";var mercadoPagoUrl=\"\".concat(baseMercadoPagoUrl);var MercadoPago=/*#__PURE__*/function(_Component){_inherits(MercadoPago,_Component);var _super=_createSuper(MercadoPago);function MercadoPago(props){var _this;_classCallCheck(this,MercadoPago);_this=_super.call(this,props);_this.doSubmit=false;_this.initMercadoPago=function(){window.Mercadopago.setPublishableKey(\"APP_USR-7aa96788-ec38-46fb-9f9b-0a01a2104d501\");};_this.mercadoLoad=function(e){if(window.Mercadopago){_this.initMercadoPago();console.log(\"mercadoPago\",window.Mercadopago);}};_this.mercadoEvent=function(mercadoEvent){var origin=mercadoEvent.origin,data=mercadoEvent.data;_this.initMercadoPago();if(typeof data===\"string\"){console.log(\"data es igual a string\");console.log(\"mercadoPago\",window.Mercadopago);}};_this.doPay=function(event){var cardNumber=_this.state.cardNumber;event.preventDefault();console.log(\"dopay is called\");console.log(\"mercadoPago\",window.Mercadopago);var $form=document.querySelector(\"#pay\");var token=window.Mercadopago.createToken($form,_this.sdkResponseHandler);// The function \"sdkResponseHandler\" is defined below\nconsole.log(\"token: \",token);return false;};_this.setPaymentMethodInfo=function(status,response){console.log(\"status\",status);console.log(\"response\",response);var bin=_this.state.cardNumber.substring(0,6);if(status==200){var paymentMethodElement=document.querySelector(\"input[name=paymentMethodId]\");if(paymentMethodElement){paymentMethodElement.value=response[0].id;}else{var form=document.querySelector(\"#pay\");var input=document.createElement(\"input\");input.setAttribute(\"name\",\"paymentMethodId\");input.setAttribute(\"type\",\"hidden\");input.setAttribute(\"value\",response[0].id);form.appendChild(input);}window.Mercadopago.getInstallments({bin:bin,amount:parseFloat(document.querySelector(\"#amount\").value)},_this.setInstallmentInfo);}else{alert(\"payment method info error: \".concat(response));}};_this.sdkResponseHandler=function(status,response){console.log(\"status \",status);console.log(\"response \",response);if(status!=200&&status!=201){alert(\"Error al validar la información\");}else{var form=document.querySelector(\"#pay\");var card=document.createElement(\"input\");card.setAttribute(\"name\",\"token\");card.setAttribute(\"type\",\"hidden\");card.setAttribute(\"value\",response.id);form.appendChild(card);_this.doSubmit=true;form.submit();}};_this.state={amount:0,cardNumber:\"\",docNumber:\"\",email:\"\"};return _this;}_createClass(MercadoPago,[{key:\"componentDidMount\",value:function componentDidMount(){if(this.props.cupon===\"STARKCLASS50\"){//check this logic !!!\nalert(\"cupón aceptado\");window.location.replace(\"https://express.culqi.com/pago/6339-2032\");//window.location.reload();\n}else{alert(\"no valido \");window.location.reload();}var script=document.createElement(\"script\");console.log(\"auth: \",this.props.auth);script.id=mercadoPagoId;script.src=mercadoPagoUrl;script.async=true;script.onload=this.mercadoLoad;this.mercadoPagoScript=script;document.body.appendChild(this.mercadoPagoScript);var input=window.onload=document.getElementById(\"cardNumber\");input.onpaste=function(e){e.preventDefault();};window.addEventListener(\"message\",this.mercadoEvent,false);this.addEvent(document.querySelector(\"#pay\"),\"submit\",this.doPay);}},{key:\"addEvent\",value:function addEvent(to,type,fn){if(document.addEventListener){to.addEventListener(type,fn,false);}else if(document.attachEvent){to.attachEvent(\"on\"+type,fn);}else{to[\"on\"+type]=fn;}}},{key:\"setInstallmentInfo\",value:function setInstallmentInfo(status,response){var selectorInstallments=document.querySelector(\"#installments\"),fragment=document.createDocumentFragment();selectorInstallments.options.length=0;if(response.length>0){var option=new Option(\"Eliga\",\"-1\"),payerCosts=response[0].payer_costs;fragment.appendChild(option);for(var i=0;i<payerCosts.length;i++){fragment.appendChild(new Option(payerCosts[i].recommended_message,payerCosts[i].installments));}selectorInstallments.appendChild(fragment);selectorInstallments.removeAttribute(\"disabled\");}}},{key:\"guessingPaymentMethod\",value:function guessingPaymentMethod(){console.log(this.state);var bin=this.state.cardNumber;if(bin.length==6){window.Mercadopago.getPaymentMethod({bin:bin},this.setPaymentMethodInfo);}}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",null)// <ReactShadowScroll>\n// <form\n//   id=\"pay\"\n//   name=\"pay\"\n//   method=\"POST\"\n//   action={`${process.env.REACT_APP_API_URL}/api/pagos/pay`}\n//   style={{ height: 400, overflow: \"auto\", overflowX: \"hidden\" }}\n// >\n//   <div className=\"row\">\n//     <div className=\"form-group col-lg-6 col-md-6 col-sm-6\">\n//       <label htmlFor=\"cardholderName\">Titular de la tarjeta</label>\n//       <input\n//         className=\"form-control\"\n//         type=\"text\"\n//         id=\"cardholderName\"\n//         data-checkout=\"cardholderName\"\n//       />\n//     </div>\n//     <div className=\"form-group col-lg-6 col-md-6 col-sm-6\">\n//       <label htmlFor=\"email\">Email</label>\n//       <input\n//         className=\"form-control \"\n//         type=\"email\"\n//         id=\"email\"\n//         name=\"email\"\n//         value={this.state.email}\n//         onChange={e => {\n//           this.setState({ email: e.target.value });\n//         }}\n//       />\n//     </div>\n//     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n//       <label htmlFor=\"cardNumber\">Número de tarjeta</label>\n//       <input\n//         className=\"form-control\"\n//         type=\"text\"\n//         id=\"cardNumber\"\n//         data-checkout=\"cardNumber\"\n//         value={this.state.cardNumber}\n//         onChange={e => {\n//           this.guessingPaymentMethod();\n//           this.setState({ cardNumber: e.target.value });\n//         }}\n//         onPaste={() => false}\n//         onCopy={() => false}\n//         onCut={() => false}\n//         onDrag={() => false}\n//         onDrop={() => false}\n//         autoComplete=\"off\"\n//       />\n//     </div>\n//     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n//       <label htmlFor=\"cardExpirationMonth\">Mes de expiración</label>\n//       <input\n//         className=\"form-control\"\n//         type=\"text\"\n//         id=\"cardExpirationMonth\"\n//         data-checkout=\"cardExpirationMonth\"\n//         onPaste={() => false}\n//         onCopy={() => false}\n//         onCut={() => false}\n//         onDrag={() => false}\n//         onDrop={() => false}\n//         autoComplete=\"off\"\n//       />\n//     </div>\n//     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n//       <label htmlFor=\"cardExpirationYear\">Año de expiración</label>\n//       <input\n//         className=\"form-control\"\n//         type=\"text\"\n//         id=\"cardExpirationYear\"\n//         data-checkout=\"cardExpirationYear\"\n//         onPaste={() => false}\n//         onCopy={() => false}\n//         onCut={() => false}\n//         onDrag={() => false}\n//         onDrop={() => false}\n//         autoComplete=\"off\"\n//       />\n//     </div>\n//     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n//       <label htmlFor=\"securityCode\">CVV</label>\n//       <input\n//         className=\"form-control\"\n//         type=\"text\"\n//         id=\"securityCode\"\n//         data-checkout=\"securityCode\"\n//         onPaste={() => false}\n//         onCopy={() => false}\n//         onCut={() => false}\n//         onDrag={() => false}\n//         onDrop={() => false}\n//         autoComplete=\"off\"\n//       />\n//     </div>\n//     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n//       <label for=\"docType\">Tipo de documento</label>\n//       <select\n//         id=\"docType\"\n//         data-checkout=\"docType\"\n//         className=\"form-control\"\n//       >\n//         <option value=\"DNI\">DNI</option>\n//         <option value=\"CEX\">Carnet de Extranjería</option>\n//       </select>\n//     </div>\n//     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n//       <label for=\"docNumber\">Número de documento</label>\n//       <input\n//         className=\"form-control\"\n//         type=\"text\"\n//         id=\"docNumber\"\n//         data-checkout=\"docNumber\"\n//         value={this.state.docNumber}\n//         onChange={e => {\n//           this.setState({ docNumber: e.target.value });\n//         }}\n//       />\n//     </div>\n//     <div className=\"form-group col-lg-12 col-md-12 col-sm-12\">\n//       <div className=\"form-group\">\n//         <label htmlFor=\"installments\">Cuotas:</label>\n//         <select\n//           id=\"installments\"\n//           className=\"form-control\"\n//           name=\"installments\"\n//         >\n//           <option value=\"0\">0 cuotas</option>\n//           <option value=\"1\">1 cuota</option>\n//         </select>\n//       </div>\n//     </div>\n//     <div className=\"form-group col-lg-12 col-md-12 col-sm-12\">\n//       <input\n//         type=\"hidden\"\n//         name=\"amount\"\n//         id=\"amount\"\n//         value={this.props.cupon === \"STARKCLASS50\" ? 299 : 349}\n//       />\n//       <input\n//         type=\"hidden\"\n//         name=\"description\"\n//         value=\"Starkclass ciclo PRE uLima\"\n//       />\n//       <input\n//         type=\"hidden\"\n//         name=\"userId\"\n//         value={this.props.auth.user.id}\n//       />\n//       <input\n//         type=\"hidden\"\n//         name=\"userEmail\"\n//         value={this.props.auth.user.email || \"\"}\n//       />\n//       <input\n//         type=\"submit\"\n//         value={\n//           this.props.cupon === \"STARKCLASS51\"\n//             ? \"Pagar S/ 2.00\"\n//             : \"Pagar S/ 349.00\"\n//         }\n//         className=\"btn btn-lg btn-primary w-100\"\n//       />\n//     </div>\n//   </div>\n// </form>\n// // </ReactShadowScroll>\n;}}]);return MercadoPago;}(Component);var mapStateToProps=function mapStateToProps(state){return{auth:state.auth};};var mapDispatchToProps=function mapDispatchToProps(dispatch,props){return{};};export default connect(mapStateToProps,mapDispatchToProps)(MercadoPago);","map":{"version":3,"sources":["/home/chris/repos/StarkClass_Server/client/src/components/mercadoPago/index.cem.js"],"names":["React","Component","connect","baseMercadoPagoUrl","mercadoPagoId","mercadoPagoUrl","MercadoPago","props","doSubmit","initMercadoPago","window","Mercadopago","setPublishableKey","mercadoLoad","e","console","log","mercadoEvent","origin","data","doPay","event","cardNumber","state","preventDefault","$form","document","querySelector","token","createToken","sdkResponseHandler","setPaymentMethodInfo","status","response","bin","substring","paymentMethodElement","value","id","form","input","createElement","setAttribute","appendChild","getInstallments","amount","parseFloat","setInstallmentInfo","alert","card","submit","docNumber","email","cupon","location","replace","reload","script","auth","src","async","onload","mercadoPagoScript","body","getElementById","onpaste","addEventListener","addEvent","to","type","fn","attachEvent","selectorInstallments","fragment","createDocumentFragment","options","length","option","Option","payerCosts","payer_costs","i","recommended_message","installments","removeAttribute","getPaymentMethod","mapStateToProps","mapDispatchToProps","dispatch"],"mappings":"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CAAcE,YAFhB,CADF,EAMD,CAEDX,oBAAoB,CAAC7B,WAArB,CAAiC8B,QAAjC,EACAD,oBAAoB,CAACY,eAArB,CAAqC,UAArC,EACD,CACF,C,qEAEuB,CACtBrE,OAAO,CAACC,GAAR,CAAY,KAAKO,KAAjB,EACA,GAAIW,CAAAA,GAAG,CAAG,KAAKX,KAAL,CAAWD,UAArB,CAEA,GAAIY,GAAG,CAAC0C,MAAJ,EAAc,CAAlB,CAAqB,CACnBlE,MAAM,CAACC,WAAP,CAAmB0E,gBAAnB,CACE,CACEnD,GAAG,CAAEA,GADP,CADF,CAIE,KAAKH,oBAJP,EAMD,CACF,C,uCAmBQ,CACP,mBACE,+BACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1KF,CA4KD,C,yBA5VuB9B,S,EA+V1B,GAAMqF,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAA/D,KAAK,QAAK,CAChCmC,IAAI,CAAEnC,KAAK,CAACmC,IADoB,CAAL,EAA7B,CAIA,GAAM6B,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,QAAD,CAAWjF,KAAX,QAAsB,EAAtB,EAA3B,CAEA,cAAeL,CAAAA,OAAO,CAACoF,eAAD,CAAkBC,kBAAlB,CAAP,CAA6CjF,WAA7C,CAAf","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\n\nconst baseMercadoPagoUrl =\n  \"https://secure.mlstatic.com/sdk/javascript/v1/mercadopago.js\";\nconst mercadoPagoId = \"mercado-pagojs\";\nconst mercadoPagoUrl = `${baseMercadoPagoUrl}`;\n\nclass MercadoPago extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      amount: 0,\n      cardNumber: \"\",\n      docNumber: \"\",\n      email: \"\"\n    };\n  }\n  doSubmit = false;\n\n  componentDidMount() {\n    if (this.props.cupon === \"STARKCLASS50\") {\n      //check this logic !!!\n      alert(\"cupón aceptado\");\n      window.location.replace(\"https://express.culqi.com/pago/6339-2032\");\n      //window.location.reload();\n    } else {\n      alert(\"no valido \");\n      window.location.reload();\n    }\n    const script = document.createElement(\"script\");\n    console.log(\"auth: \", this.props.auth);\n    script.id = mercadoPagoId;\n    script.src = mercadoPagoUrl;\n    script.async = true;\n    script.onload = this.mercadoLoad;\n\n    this.mercadoPagoScript = script;\n\n    document.body.appendChild(this.mercadoPagoScript);\n    const input = (window.onload = document.getElementById(\"cardNumber\"));\n    input.onpaste = function(e) {\n      e.preventDefault();\n    };\n    window.addEventListener(\"message\", this.mercadoEvent, false);\n    this.addEvent(document.querySelector(\"#pay\"), \"submit\", this.doPay);\n  }\n\n  initMercadoPago = () => {\n    window.Mercadopago.setPublishableKey(\n      \"APP_USR-7aa96788-ec38-46fb-9f9b-0a01a2104d501\"\n    );\n  };\n\n  mercadoLoad = e => {\n    if (window.Mercadopago) {\n      this.initMercadoPago();\n      console.log(\"mercadoPago\", window.Mercadopago);\n    }\n  };\n\n  mercadoEvent = mercadoEvent => {\n    const { origin, data } = mercadoEvent;\n    this.initMercadoPago();\n\n    if (typeof data === \"string\") {\n      console.log(\"data es igual a string\");\n      console.log(\"mercadoPago\", window.Mercadopago);\n    }\n  };\n\n  doPay = event => {\n    let cardNumber = this.state.cardNumber;\n    event.preventDefault();\n    console.log(\"dopay is called\");\n    console.log(\"mercadoPago\", window.Mercadopago);\n\n    var $form = document.querySelector(\"#pay\");\n\n    let token = window.Mercadopago.createToken($form, this.sdkResponseHandler); // The function \"sdkResponseHandler\" is defined below\n\n    console.log(\"token: \", token);\n    return false;\n  };\n\n  addEvent(to, type, fn) {\n    if (document.addEventListener) {\n      to.addEventListener(type, fn, false);\n    } else if (document.attachEvent) {\n      to.attachEvent(\"on\" + type, fn);\n    } else {\n      to[\"on\" + type] = fn;\n    }\n  }\n\n  setPaymentMethodInfo = (status, response) => {\n    console.log(\"status\", status);\n    console.log(\"response\", response);\n    let bin = this.state.cardNumber.substring(0, 6);\n    if (status == 200) {\n      const paymentMethodElement = document.querySelector(\n        \"input[name=paymentMethodId]\"\n      );\n\n      if (paymentMethodElement) {\n        paymentMethodElement.value = response[0].id;\n      } else {\n        let form = document.querySelector(\"#pay\");\n        const input = document.createElement(\"input\");\n        input.setAttribute(\"name\", \"paymentMethodId\");\n        input.setAttribute(\"type\", \"hidden\");\n        input.setAttribute(\"value\", response[0].id);\n\n        form.appendChild(input);\n      }\n\n      window.Mercadopago.getInstallments(\n        {\n          bin: bin,\n          amount: parseFloat(document.querySelector(\"#amount\").value)\n        },\n        this.setInstallmentInfo\n      );\n    } else {\n      alert(`payment method info error: ${response}`);\n    }\n  };\n\n  setInstallmentInfo(status, response) {\n    var selectorInstallments = document.querySelector(\"#installments\"),\n      fragment = document.createDocumentFragment();\n    selectorInstallments.options.length = 0;\n\n    if (response.length > 0) {\n      var option = new Option(\"Eliga\", \"-1\"),\n        payerCosts = response[0].payer_costs;\n      fragment.appendChild(option);\n\n      for (var i = 0; i < payerCosts.length; i++) {\n        fragment.appendChild(\n          new Option(\n            payerCosts[i].recommended_message,\n            payerCosts[i].installments\n          )\n        );\n      }\n\n      selectorInstallments.appendChild(fragment);\n      selectorInstallments.removeAttribute(\"disabled\");\n    }\n  }\n\n  guessingPaymentMethod() {\n    console.log(this.state);\n    var bin = this.state.cardNumber;\n\n    if (bin.length == 6) {\n      window.Mercadopago.getPaymentMethod(\n        {\n          bin: bin\n        },\n        this.setPaymentMethodInfo\n      );\n    }\n  }\n\n  sdkResponseHandler = (status, response) => {\n    console.log(\"status \", status);\n    console.log(\"response \", response);\n    if (status != 200 && status != 201) {\n      alert(\"Error al validar la información\");\n    } else {\n      var form = document.querySelector(\"#pay\");\n      var card = document.createElement(\"input\");\n      card.setAttribute(\"name\", \"token\");\n      card.setAttribute(\"type\", \"hidden\");\n      card.setAttribute(\"value\", response.id);\n      form.appendChild(card);\n      this.doSubmit = true;\n      form.submit();\n    }\n  };\n\n  render() {\n    return (\n      <div></div>\n      // <ReactShadowScroll>\n      // <form\n      //   id=\"pay\"\n      //   name=\"pay\"\n      //   method=\"POST\"\n      //   action={`${process.env.REACT_APP_API_URL}/api/pagos/pay`}\n      //   style={{ height: 400, overflow: \"auto\", overflowX: \"hidden\" }}\n      // >\n      //   <div className=\"row\">\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-6\">\n      //       <label htmlFor=\"cardholderName\">Titular de la tarjeta</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"cardholderName\"\n      //         data-checkout=\"cardholderName\"\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-6\">\n      //       <label htmlFor=\"email\">Email</label>\n      //       <input\n      //         className=\"form-control \"\n      //         type=\"email\"\n      //         id=\"email\"\n      //         name=\"email\"\n      //         value={this.state.email}\n      //         onChange={e => {\n      //           this.setState({ email: e.target.value });\n      //         }}\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label htmlFor=\"cardNumber\">Número de tarjeta</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"cardNumber\"\n      //         data-checkout=\"cardNumber\"\n      //         value={this.state.cardNumber}\n      //         onChange={e => {\n      //           this.guessingPaymentMethod();\n      //           this.setState({ cardNumber: e.target.value });\n      //         }}\n      //         onPaste={() => false}\n      //         onCopy={() => false}\n      //         onCut={() => false}\n      //         onDrag={() => false}\n      //         onDrop={() => false}\n      //         autoComplete=\"off\"\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label htmlFor=\"cardExpirationMonth\">Mes de expiración</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"cardExpirationMonth\"\n      //         data-checkout=\"cardExpirationMonth\"\n      //         onPaste={() => false}\n      //         onCopy={() => false}\n      //         onCut={() => false}\n      //         onDrag={() => false}\n      //         onDrop={() => false}\n      //         autoComplete=\"off\"\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label htmlFor=\"cardExpirationYear\">Año de expiración</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"cardExpirationYear\"\n      //         data-checkout=\"cardExpirationYear\"\n      //         onPaste={() => false}\n      //         onCopy={() => false}\n      //         onCut={() => false}\n      //         onDrag={() => false}\n      //         onDrop={() => false}\n      //         autoComplete=\"off\"\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label htmlFor=\"securityCode\">CVV</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"securityCode\"\n      //         data-checkout=\"securityCode\"\n      //         onPaste={() => false}\n      //         onCopy={() => false}\n      //         onCut={() => false}\n      //         onDrag={() => false}\n      //         onDrop={() => false}\n      //         autoComplete=\"off\"\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label for=\"docType\">Tipo de documento</label>\n      //       <select\n      //         id=\"docType\"\n      //         data-checkout=\"docType\"\n      //         className=\"form-control\"\n      //       >\n      //         <option value=\"DNI\">DNI</option>\n      //         <option value=\"CEX\">Carnet de Extranjería</option>\n      //       </select>\n      //     </div>\n      //     <div className=\"form-group col-lg-6 col-md-6 col-sm-12\">\n      //       <label for=\"docNumber\">Número de documento</label>\n      //       <input\n      //         className=\"form-control\"\n      //         type=\"text\"\n      //         id=\"docNumber\"\n      //         data-checkout=\"docNumber\"\n      //         value={this.state.docNumber}\n      //         onChange={e => {\n      //           this.setState({ docNumber: e.target.value });\n      //         }}\n      //       />\n      //     </div>\n      //     <div className=\"form-group col-lg-12 col-md-12 col-sm-12\">\n      //       <div className=\"form-group\">\n      //         <label htmlFor=\"installments\">Cuotas:</label>\n      //         <select\n      //           id=\"installments\"\n      //           className=\"form-control\"\n      //           name=\"installments\"\n      //         >\n      //           <option value=\"0\">0 cuotas</option>\n      //           <option value=\"1\">1 cuota</option>\n      //         </select>\n      //       </div>\n      //     </div>\n      //     <div className=\"form-group col-lg-12 col-md-12 col-sm-12\">\n      //       <input\n      //         type=\"hidden\"\n      //         name=\"amount\"\n      //         id=\"amount\"\n      //         value={this.props.cupon === \"STARKCLASS50\" ? 299 : 349}\n      //       />\n      //       <input\n      //         type=\"hidden\"\n      //         name=\"description\"\n      //         value=\"Starkclass ciclo PRE uLima\"\n      //       />\n      //       <input\n      //         type=\"hidden\"\n      //         name=\"userId\"\n      //         value={this.props.auth.user.id}\n      //       />\n      //       <input\n      //         type=\"hidden\"\n      //         name=\"userEmail\"\n      //         value={this.props.auth.user.email || \"\"}\n      //       />\n\n      //       <input\n      //         type=\"submit\"\n      //         value={\n      //           this.props.cupon === \"STARKCLASS51\"\n      //             ? \"Pagar S/ 2.00\"\n      //             : \"Pagar S/ 349.00\"\n      //         }\n      //         className=\"btn btn-lg btn-primary w-100\"\n      //       />\n      //     </div>\n      //   </div>\n      // </form>\n      // // </ReactShadowScroll>\n    );\n  }\n}\n\nconst mapStateToProps = state => ({\n  auth: state.auth\n});\n\nconst mapDispatchToProps = (dispatch, props) => ({});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MercadoPago);\n"]},"metadata":{},"sourceType":"module"}